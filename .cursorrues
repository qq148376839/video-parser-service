# 沟通确认规范（Communication & Clarification）

## 🎯 核心原则（最高优先级）

**先确认后执行**：在每次对话开始时，**必须先确认需求，再执行任何操作**。禁止在需求不明确时直接开始开发、生成文档、编写代码或执行其他操作。

**强制执行**：

- ✅ 收到用户需求后，**立即停止**，不要开始任何操作
- ✅ 先使用结构化提问确认需求细节
- ✅ **必须等待**用户回答所有问题后再执行
- ❌ **禁止**在需求不明确时直接开始工作

## ⚠️ 必须咨询确认的情况

### 1. 需求不明确

**场景**: 用户描述的功能需求不够具体或存在歧义

**处理方式**:

- ❌ **禁止**: 猜测用户意图，直接开始编码
- ✅ **必须**: 主动询问，列出问题列表

**示例问题**:

```
在开始实现之前，我需要确认几个问题：

1. **功能需求确认**
   - 这个功能的具体使用场景是什么？
   - 用户期望的行为是什么？
   - 有哪些边界情况需要处理？

2. **输入输出确认**
   - 输入数据的格式是什么？
   - 输出数据的格式是什么？
   - 有哪些必填字段？

3. **异常处理确认**
   - 出现错误时如何处理？
   - 需要显示什么错误信息？
   - 是否需要重试机制？

请确认以上问题，我会根据您的回答进行开发。
```

### 2. 技术方案不确定

**场景**: 有多种技术实现方式，不确定应该选择哪种

**处理方式**:

- ❌ **禁止**: 假设技术实现方式，直接选择一种方案
- ✅ **必须**: 列出可选方案，说明优缺点，等待用户选择

**示例问题**:

```
关于技术实现，我有几个方案：

**方案A**: [方案描述]
- 优点: ...
- 缺点: ...
- 适用场景: ...

**方案B**: [方案描述]
- 优点: ...
- 缺点: ...
- 适用场景: ...

您更倾向于哪个方案？或者有其他要求？
```

### 3. 业务逻辑模糊

**场景**: 业务规则不清晰，存在多种理解方式

**处理方式**:

- ❌ **禁止**: 自行推断业务规则，直接实现
- ✅ **必须**: 列出可能的理解方式，确认正确的业务规则

**示例问题**:

```
关于业务逻辑，我需要确认：

1. **规则确认**
   - 规则A的理解是否正确：...
   - 规则B的理解是否正确：...
   - 是否有特殊情况需要处理？

2. **状态转换确认**
   - 状态A可以转换到哪些状态？
   - 状态转换的条件是什么？
   - 是否有状态转换的限制？

请确认以上业务规则，我会按照您的确认进行实现。
```

### 4. 数据格式不明确

**场景**: 输入输出数据的格式、结构不明确

**处理方式**:

- ❌ **禁止**: 假设数据格式，直接定义数据结构
- ✅ **必须**: 询问数据格式，确认字段类型和结构

**示例问题**:

```
关于数据格式，我需要确认：

1. **输入数据格式**
   - 字段1的类型是什么？（string/number/boolean）
   - 字段1是否必填？
   - 字段1的默认值是什么？
   - 字段1的验证规则是什么？

2. **输出数据格式**
   - 需要返回哪些字段？
   - 字段的格式是什么？
   - 是否需要分页？

请提供数据格式的详细说明，我会按照您的规范进行实现。
```

### 5. 集成点不清楚

**场景**: 需要调用外部 API 或集成其他系统，但接口规范不清楚

**处理方式**:

- ❌ **禁止**: 假设 API 接口，直接调用
- ✅ **必须**: 询问接口规范，确认请求参数和响应格式

**示例问题**:

```
关于API集成，我需要确认：

1. **接口规范确认**
   - API的URL是什么？
   - 请求方法是什么？（GET/POST/PUT/DELETE）
   - 请求参数有哪些？
   - 请求参数的格式是什么？

2. **响应格式确认**
   - 成功响应的格式是什么？
   - 错误响应的格式是什么？
   - 有哪些错误码？

3. **认证方式确认**
   - 需要什么认证方式？（Token/API Key）
   - 认证信息如何传递？

请提供API文档或接口规范，我会按照规范进行集成。
```

## 📋 咨询确认的标准流程（强制执行）

### 步骤 1: 立即停止

**收到用户需求后，立即停止所有操作**：

- ❌ 不要开始编码
- ❌ 不要生成文档
- ❌ 不要编写测试用例
- ❌ 不要执行任何操作
- ✅ 先分析需求，识别不确定点

### 步骤 2: 识别不确定点

仔细分析用户需求，识别所有不确定的地方：

- 需求是否明确？（功能、目标、范围）
- 技术方案是否确定？（实现方式、技术选型）
- 业务规则是否清晰？（逻辑、流程、边界）
- 数据格式是否明确？（输入、输出、结构）
- 集成点是否清楚？（API、接口、依赖）
- **文档是否已存在**？（检查 `docs/features/` 目录）

### 步骤 3: 列出问题列表

使用清晰的结构列出需要确认的问题：

- 使用分类（需求、技术、业务、数据、集成、文档）
- 使用列表格式，便于用户回答
- 每个问题要具体明确
- 使用复选框格式，便于用户逐项确认

**示例格式**：

```
在开始 [操作] 之前，我需要确认几个问题：

1. **需求确认**
   - [ ] 问题1：...
   - [ ] 问题2：...

2. **技术方案确认**
   - [ ] 问题1：...
   - [ ] 问题2：...

3. **文档管理确认**
   - [ ] 是否已存在相关文档？
   - [ ] 如果存在，是更新现有文档还是创建新文档？

请确认以上问题，我会根据您的回答进行 [操作]。
```

### 步骤 4: 等待用户确认（必须等待）

- ❌ **禁止**：在用户未回答时开始工作
- ✅ **必须**：等待用户回答所有问题
- ✅ **必须**：如果用户只回答了部分问题，继续询问未回答的问题
- ✅ **必须**：确认所有问题后再执行

### 步骤 5: 根据确认结果执行

- 根据用户的确认结果执行操作
- 如果确认后仍有不确定的地方，继续询问
- 执行过程中发现新的不确定点，立即停止并询问

### 步骤 6: 文档管理检查（生成文档前必须执行）

在生成 PRD 文档前，必须：

1. 检查 `docs/features/` 目录是否已存在相关文档
2. 如果存在：
   - ✅ 询问用户：是更新现有文档还是创建新文档？
   - ✅ 如果更新，更新现有文档的相应章节
   - ❌ **禁止**：直接创建新文档
3. 如果不存在：
   - ✅ 创建新文档，使用中文功能名称
   - ✅ 格式：`YYMMDD-功能名称-PRD.md`

## 💬 咨询确认的示例格式

### 格式 1: 需求确认

```
在开始实现 [功能名称] 之前，我需要确认几个问题：

1. **功能需求确认**
   - [ ] 问题1：...
   - [ ] 问题2：...

2. **技术实现确认**
   - [ ] 问题1：...
   - [ ] 问题2：...

3. **业务规则确认**
   - [ ] 问题1：...
   - [ ] 问题2：...

请确认以上问题，我会根据您的回答进行开发。
```

### 格式 2: 方案选择

```
关于 [功能/问题] 的实现，我有几个方案：

**方案A**: [方案描述]
- 优点: ...
- 缺点: ...
- 适用场景: ...

**方案B**: [方案描述]
- 优点: ...
- 缺点: ...
- 适用场景: ...

您更倾向于哪个方案？或者有其他要求？
```

### 格式 3: 规则确认

```
关于 [业务规则/技术规则] 的理解，我需要确认：

1. **规则理解确认**
   - 我的理解是：...
   - 是否正确？

2. **特殊情况确认**
   - 情况A：...
   - 情况B：...
   - 这些情况如何处理？

请确认以上理解是否正确，我会按照您的确认进行实现。
```

## ❌ 禁止行为（严格执行）

### 需求确认阶段禁止行为

- ❌ **禁止**: 在不确定的情况下直接开始编码
- ❌ **禁止**: 在不确定的情况下直接生成 PRD 文档
- ❌ **禁止**: 假设用户意图或业务规则
- ❌ **禁止**: 使用"可能"、"应该"等不确定词汇后直接实现
- ❌ **禁止**: 跳过确认环节，直接提供代码或文档
- ❌ **禁止**: 在用户未确认的情况下，自行选择技术方案
- ❌ **禁止**: 在用户未回答问题时开始工作

### 文档管理禁止行为

- ❌ **禁止**: 为同一需求创建多个文档（PRD、TEST、SUMMARY 等）
- ❌ **禁止**: 使用英文功能名称命名文档
- ❌ **禁止**: 生成文档前不检查是否已存在相关文档
- ❌ **禁止**: 为测试、实施、总结创建独立文档（应更新现有文档）

## ✅ 鼓励行为（严格执行）

### 需求确认鼓励行为

- ✅ **鼓励**: 主动识别不确定点
- ✅ **鼓励**: 列出清晰的问题列表
- ✅ **鼓励**: **必须等待**用户确认后再行动
- ✅ **鼓励**: 在确认后提供明确的实现方案
- ✅ **鼓励**: 提供多个可选方案供用户选择
- ✅ **鼓励**: 在开发过程中发现新的不确定点，立即停止并询问

### 文档管理鼓励行为

- ✅ **鼓励**: 生成文档前先检查是否已存在相关文档
- ✅ **鼓励**: 使用中文功能名称命名文档
- ✅ **鼓励**: 同一需求只维护一个文档
- ✅ **鼓励**: 需求变更时更新现有文档
- ✅ **鼓励**: 实施总结、测试结果添加到现有文档中

## 🎯 沟通确认的最佳实践（强制执行）

1. **立即停止**: 收到用户需求后，立即停止所有操作，先确认需求
2. **主动识别**: 不要等到开发完成才发现理解错误，在开始前就识别不确定点
3. **问题清晰**: 问题要具体明确，便于用户回答
4. **分类组织**: 使用分类组织问题，便于用户理解
5. **必须等待**: **必须等待**用户确认，不要急于开始
6. **持续沟通**: 开发过程中发现新问题，立即停止并沟通确认
7. **文档检查**: 生成文档前必须检查是否已存在相关文档
8. **单一文档**: 同一需求只维护一个文档，不要创建多个文档

---

**版本**: v1.0  
**最后更新**: 2025-12-22  
**适用场景**: 所有开发、需求分析、代码审查场景
