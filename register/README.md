# 批量注册 jx.2s0.cn 账号工具

## 📋 目录

- [功能说明](#功能说明)
- [特性](#特性)
- [安装依赖](#安装依赖)
- [使用方法](#使用方法)
- [注册流程](#注册流程)
- [输出结果](#输出结果)
- [技术实现](#技术实现)
- [注意事项](#注意事项)
- [常见问题](#常见问题)

## 功能说明

这是一个自动化批量注册脚本，用于批量注册 `json.2s0.cn:5678` 账号并获取 `uid` 和 `key` 参数。

脚本使用浏览器自动化技术（Playwright）模拟真实用户操作，包括：
- 填写邮箱和密码
- 滑动滑块验证
- 自动提取账号信息
- 保存注册结果

## 特性

- ✅ **独立浏览器实例**：使用独立Chrome浏览器，避免被检测为自动化工具
- ✅ **反爬虫脚本**：隐藏自动化特征，模拟真实浏览器环境
- ✅ **智能邮箱生成**：使用英文名+数字的方式生成更真实的邮箱地址
- ✅ **人类化操作**：模拟人类滑动滑块操作（分段移动、随机抖动、缓动函数）
- ✅ **代理IP支持**：自动获取和使用代理IP，绕过批量注册限制
- ✅ **反爬虫检测**：智能检测反爬虫状态，自动更换浏览器和IP
- ✅ **实时保存**：每次注册成功立即保存，避免数据丢失
- ✅ **自动去重**：基于uid自动去重，避免重复保存
- ✅ **完善的错误处理**：完善的错误处理和资源清理机制

## 安装依赖

### 1. 安装Python依赖

```bash
pip install playwright requests
```

### 2. 安装Playwright浏览器

```bash
playwright install chromium
```

### 3. 确保Chrome浏览器已安装

脚本会自动查找以下路径的Chrome浏览器：
- `C:\Program Files\Google\Chrome\Application\chrome.exe`
- `C:\Program Files (x86)\Google\Chrome\Application\chrome.exe`
- `%USERPROFILE%\AppData\Local\Google\Chrome\Application\chrome.exe`

## 使用方法

### 测试单个注册（推荐先测试）

在批量注册之前，建议先测试单个注册流程，确保XPath和流程正确：

```bash
cd batch_register
python test_single_register.py
```

这个脚本会：
- 启动浏览器并执行一次完整的注册流程
- 显示详细的步骤信息
- 保持浏览器打开10秒，方便查看结果
- 如果成功，会显示uid和key

### 批量注册

```bash
cd batch_register

# 注册5个账号（默认，使用代理IP）
python batch_register_jx2s0.py

# 注册10个账号
python batch_register_jx2s0.py -n 10

# 指定密码
python batch_register_jx2s0.py -n 5 -p "your_password"

# 不使用代理IP（直连）
python batch_register_jx2s0.py -n 5 --no-proxy
```

### 命令行参数

- `-n, --count`: 注册数量（默认: 5）
- `-p, --password`: 固定密码（默认: qwer1234!）
- `--no-proxy`: 不使用代理IP（默认使用代理）

### 示例

```bash
# 注册20个账号，使用自定义密码
python batch_register_jx2s0.py -n 20 -p "MyPassword123!"

# 注册10个账号，不使用代理
python batch_register_jx2s0.py -n 10 --no-proxy
```

## 注册流程

1. **访问登录页面**: `https://json.2s0.cn:5678/user/login`
2. **填写邮箱**: 自动生成随机邮箱地址（英文名+数字格式）
3. **填写密码**: 使用指定的固定密码
4. **检查滑块状态**: 检查文字提示是否为"滑动到右侧登录"
5. **第一次滑动**: 从左到右滑动滑块验证（模拟人类操作）
6. **检查状态**: 检查是否需要第二次滑动或触发反爬虫
7. **第二次滑动**（如需要）: 如果检测到可以滑动第二次，执行第二次滑动
8. **等待跳转**: 等待自动跳转到主页 `https://json.2s0.cn:5678/user/index`
9. **获取信息**: 跳转到信息页面 `https://json.2s0.cn:5678/user/information`
10. **提取参数**: 提取 `uid` 和 `key` 参数
11. **保存结果**: 立即保存到 `registration_results.json` 文件

## 输出结果

注册结果会保存到 `batch_register/registration_results.json` 文件，格式如下：

```json
{
  "current_index": 16,
  "keys": [
    {
      "email": "alex1990@gmail.com",
      "password": "qwer1234!",
      "uid": "4059917",
      "key": "cgklotuyDGHILOTW38",
      "register_time": "2024-01-15 10:30:45",
      "expire_date": "2025-01-14 10:30:45"
    },
    {
      "email": "james123@yahoo.com",
      "password": "qwer1234!",
      "uid": "4059918",
      "key": "abc123def456ghi789",
      "register_time": "2024-01-15 10:31:20",
      "expire_date": "2025-01-14 10:31:20"
    }
  ]
}
```

### 字段说明

- **current_index**: 当前索引值（用于追踪当前使用的账号索引）
- **keys**: 注册结果数组，每个元素包含：
  - **email**: 注册邮箱地址
  - **password**: 注册密码
  - **uid**: 用户ID
  - **key**: 用户密钥
  - **register_time**: 注册时间（格式：`YYYY-MM-DD HH:MM:SS`）
  - **expire_date**: 过期日期（注册日期后的364天，格式：`YYYY-MM-DD HH:MM:SS`）

## 技术实现

### 1. 独立浏览器启动

脚本使用 `subprocess.Popen` 启动独立的Chrome进程，并通过 `--remote-debugging-port` 启用调试端口，然后使用 Playwright 的 `connect_over_cdp()` 连接到浏览器。这种方式可以避免被网站检测为自动化工具。

### 2. 反爬虫脚本

添加了反爬虫脚本，隐藏以下自动化特征：
- `navigator.webdriver` 属性
- 设置真实的 `navigator.platform` 和 `navigator.languages`
- 添加 `window.chrome` 对象
- 禁用 `debugger` 函数

### 3. 代理IP支持

- **自动获取代理**: 从 `https://white.1024proxy.com/white/api` 获取动态代理IP
- **每个账号使用不同代理**: 每个账号注册时都会获取新的代理IP
- **代理失败自动回退**: 如果代理失败，会自动尝试不使用代理重试
- **支持JSON和文本格式**: 自动识别代理API返回的格式

**代理配置**:
- 默认启用代理（可通过 `--no-proxy` 禁用）
- 每个账号使用独立的浏览器上下文和代理IP
- 自动处理代理连接失败的情况

### 4. 浏览器特征随机化

每次注册都会随机化浏览器特征：
- **随机User-Agent**: 从多个Chrome版本中随机选择（120-124）
- **随机视口大小**: 从常见分辨率中随机选择（1920x1080, 1366x768等）
- **独立浏览器上下文**: 每个账号使用新的上下文，清除Cookie和Session

### 5. 智能邮箱生成

使用英文名+数字的方式生成更真实的邮箱地址：

- **方式1**: 英文名 + 生日（如：`alex1990`）
- **方式2**: 英文名 + 随机数字（如：`alex123`）
- **方式3**: 两个英文名组合（如：`alexjames`）
- **方式4**: 英文名 + 首字母 + 数字（如：`alexj123`）

10%的概率添加下划线或点（如：`alex_1990` 或 `alex.1990`）

### 6. 滑块滑动模拟

滑块滑动操作模拟人类行为：
- **状态检查**：滑动前检查文字提示是否为"滑动到右侧登录"
- **智能等待**：如果滑块未准备好，自动等待最多5秒
- **分段移动**：30步分段移动，使用缓动函数（smoothstep）模拟加速和减速
- **随机抖动**：添加轻微的垂直抖动，模拟人类手抖
- **随机延迟**：每个移动步骤随机延迟15-25ms

### 7. 反爬虫检测与处理

脚本实现了智能的反爬虫检测和处理：

**检测机制**:
- 第一次滑动后检查状态元素 `/html/body/div/div[1]/div/div/form/div/div[1]/b`
- 如果显示"请稍后"，等待0.5秒后再次检查
- 如果0.5秒后仍然是"请稍后"，判定为触发反爬虫
- 检查滑块是否显示"验证通过"

**处理机制**:
- 检测到反爬虫后，自动关闭当前浏览器上下文
- 获取新的代理IP（如果使用代理）
- 生成新的随机浏览器特征
- 创建新的浏览器上下文
- 重新尝试注册

### 8. 滑块验证失败处理逻辑

脚本实现了智能的滑块验证失败处理：

1. **第一次滑块失败**:
   - 刷新页面
   - 重新填写表单（邮箱和密码）
   - 重新尝试滑块验证

2. **第二次滑块失败**:
   - 先检查是否已经注册成功（可能滑块已经验证通过但未跳转）
   - 如果未成功，尝试直接访问主页，检查账号是否已注册
   - 如果直接访问失败，刷新页面重新尝试

3. **最大重试次数**: 每个账号最多重试 2 次

## 注意事项

1. **代理IP**: 
   - 默认使用代理IP来绕过批量注册限制
   - 每个账号使用不同的代理IP
   - 如果代理失败，会自动尝试不使用代理重试
   - 可以通过 `--no-proxy` 参数禁用代理

2. **注册间隔**: 脚本会在每个账号注册后等待 3-6 秒，避免请求过快

3. **错误处理**: 如果某个账号注册失败，会继续注册下一个

4. **资源清理**: 脚本结束后会自动清理浏览器进程和临时文件

5. **结果保存**: 
   - ✅ **增量添加**: 如果 `registration_results.json` 文件已存在，新结果会追加到文件中
   - ✅ **自动去重**: 基于 `uid` 自动去重，避免重复保存
   - ✅ **实时保存**: 每次注册成功立即保存，避免程序错误导致数据丢失
   - ✅ **统计信息**: 显示现有记录数、新增记录数和总记录数
   - ✅ **过期日期**: 自动计算并保存过期日期（注册日期后的364天）
   - ✅ **索引追踪**: 支持 `current_index` 字段，用于追踪当前使用的账号索引
   - ✅ **格式兼容**: 自动兼容旧格式（直接是数组的JSON），并转换为新格式

6. **反爬虫检测**: 
   - 脚本会自动检测反爬虫状态
   - 检测到反爬虫后会自动更换浏览器和IP
   - 如果更换后仍然失败，会跳过该账号继续下一个

## 常见问题

### Q: 浏览器启动失败？

A: 确保已安装Chrome浏览器，并且路径正确。脚本会自动查找以下路径：
- `C:\Program Files\Google\Chrome\Application\chrome.exe`
- `C:\Program Files (x86)\Google\Chrome\Application\chrome.exe`
- `%USERPROFILE%\AppData\Local\Google\Chrome\Application\chrome.exe`

### Q: 滑块验证失败？

A: 滑块验证可能需要多次尝试。如果失败，可以：
1. 检查网络连接
2. 增加等待时间
3. 手动测试一次注册流程，确认XPath是否正确
4. 检查是否触发反爬虫检测

### Q: 注册结果为空？

A: 检查：
1. 网站是否可访问
2. XPath是否正确（网站可能更新了页面结构）
3. 查看控制台输出的错误信息
4. 检查是否触发反爬虫检测

### Q: 代理IP获取失败？

A: 
1. 检查网络连接，确保可以访问代理API
2. 如果代理API不可用，可以使用 `--no-proxy` 参数禁用代理
3. 代理失败时会自动尝试不使用代理重试

### Q: 遇到批量注册限制？

A: 
1. 脚本默认使用代理IP来绕过限制
2. 每个账号使用不同的代理IP和浏览器特征
3. 如果仍然遇到限制，可以：
   - 增加注册间隔时间（修改代码中的等待时间）
   - 减少单次注册数量
   - 分多次运行脚本
   - 检查邮箱生成策略是否过于随机

### Q: 触发反爬虫检测怎么办？

A:
1. 脚本会自动检测反爬虫状态
2. 检测到后会自动更换浏览器和IP
3. 如果更换后仍然失败，会跳过该账号继续下一个
4. 可以尝试：
   - 增加注册间隔时间
   - 减少单次注册数量
   - 更换代理IP服务商

## 文件结构

```
batch_register/
├── batch_register_jx2s0.py    # 批量注册主脚本
├── test_single_register.py    # 单个注册测试脚本
├── registration_results.json   # 注册结果文件（自动生成）
└── README.md                   # 本说明文档
```

## 开发规则遵循

本脚本严格遵循项目的开发规则：

- ✅ 使用独立浏览器实例（`/use-standalone-browser`）
- ✅ 添加反爬虫脚本（`/add-stealth-script`）
- ✅ 完善的错误处理（`/error-handling-pattern`）
- ✅ 资源清理（finally块）

## 许可证

本脚本仅用于学习和研究目的，请遵守相关法律法规和网站服务条款。
